/*! CamCalc v0.0.1 | (c) 2013 Xiao Yu, @HypertextRanch | MIT license */
(function(){var t,e,a;e="undefined"!=typeof exports&&null!==exports?exports:this,t=e.CamCalc=null!=(a=e.CamCalc)?a:{}}).call(this),function(){CamCalc.ApertureSnap=function(){function t(t){this.steps=t.steps||1/3}return t.prototype.updateSettings=function(t){return t.steps?this.steps=t.steps:void 0},t.prototype.calculate=function(t){var e,a;return e=this._calculateAV(t),a=this._snapAV(e),{aperture:this._calculateN(a)}},t.prototype.getStops=function(t,e){var a,c,r,o;for(r=this._snapAV(this._calculateAV(t))-this.steps,c=this._snapAV(this._calculateAV(e))+this.steps,o=[];c>=(r+=this.steps);)a=this._calculateN(r),a>=t&&e>=a&&o.push(a);return o},t.prototype._calculateAV=function(t){return Math.log(Math.pow(t,2))/Math.LN2},t.prototype._calculateN=function(t){var e;return e=Math.sqrt(Math.pow(2,t)),e>=22.6&&22.7>e?22:e>=10?Math.round(e):Math.round(10*e)/10},t.prototype._snapAV=function(t){var e,a,c,r,o,i,n,s,h;for(r=Math.floor(t)-this.steps,c=Math.floor(t)+1,n=function(){var t;for(t=[];c>=(r+=this.steps);)t.push(r);return t}.call(this),o=0,i=1,s=0,h=n.length;h>s;s++)e=n[s],a=Math.abs(e-t),i>a&&(o=e,i=a);return o},t}()}.call(this),function(){CamCalc.DepthOfField=function(){function t(t){this.coc=(t.coc||29)/1e3,this.aperture=t.aperture||4,this.focalLength=t.focalLength||50,this.distance=1e3*(t.distance||3)}return t.prototype.updateSettings=function(t){return t.coc&&(this.coc=t.coc/1e3),t.aperture&&(this.aperture=t.aperture),t.focalLength&&(this.focalLength=t.focalLength),t.distance?this.distance=1e3*t.distance:void 0},t.prototype.calculate=function(){var t,e,a;return a=this._calculateFocusSpread(this.coc,this.aperture),e=this._calculateLimitNear(a,this.focalLength,this.distance),t=this._calculateLimitFar(e,this.distance),{nearLimit:e/1e3,farLimit:t/1e3,depth:this._calculateDepth(e,t)/1e3}},t.prototype._calculateFocusSpread=function(t,e){return e*Math.sqrt(562500*Math.pow(t,2)-Math.pow(e,2))/375},t.prototype._calculateLimitNear=function(t,e,a){var c,r,o,i,n;return i=Math.pow(a-e,2)*Math.pow(t,2),n=Math.pow(e,2)*Math.pow(a,2),r=e*Math.sqrt(i+n),o=Math.pow(e,2)*a-Math.pow(e,2)*t,c=(a-2*e)*t+2*Math.pow(e,2),(r+o)/c},t.prototype._calculateLimitFar=function(t,e){return e>=2*t?1/0:t*e/(2*t-e)},t.prototype._calculateDepth=function(t,e){return isFinite(e)?e-t:1/0},t}()}.call(this),function(){CamCalc.IdealAperture=function(){function t(t){this.focalLength=t.focalLength||50,this.objectNear=1e3*(t.objectNear||4),this.objectFar=1e3*(t.objectFar||5),this._swapDistances()}return t.prototype.updateSettings=function(t){return t.focalLength&&(this.focalLength=t.focalLength),t.objectNear&&(this.objectNear=1e3*t.objectNear),t.objectFar&&(this.objectFar=1e3*t.objectFar),this._swapDistances()},t.prototype.calculate=function(){return{aperture:this._calculateAperture(this.objectNear,this.objectFar,this.focalLength),distance:this._calculateDistance(this.objectNear,this.objectFar)/1e3}},t.prototype._calculateAperture=function(t,e,a){return Math.sqrt(375*(t*a/(t-a)-e*a/(e-a)))},t.prototype._calculateDistance=function(t,e){return 2*t*e/(t+e)},t.prototype._swapDistances=function(){var t;if(!(this.objectNear<=this.objectFar))return t=this.objectNear,this.objectNear=this.objectFar,this.objectFar=t},t}()}.call(this);